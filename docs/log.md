# ログ仕様

## 目的

マイクロコンテンツにアクセスしてきた受講者の行動ログを取得する．

## ログ取得対象

| 対象   | ログ取得対象 |  LTIでの対象判定                                                   | 補足                                      | 
| ------ | ------------ | ------------------------------------------------------------------ | ----------------------------------------- | 
| 管理者 | ×           | roles に administrator が含まれている                              | LMSの管理者からのアクセスを想定           | 
| 教師   | ×           | roles に administrator が含まれておらず，instructor が含まれている | LMSの教師やサポーターからのアクセスを想定 | 
| 受講者 | 〇           | 上記以外                                                           | LMSの受講者からのアクセスを想定           | 

## 出力するログ

| ログ内容                           | 出力例                                                                                                              | 補足                         | 
| ---------------------------------- | ------------------------------------------------------------------------------------------------------------------- | ---------------------------- | 
| サーバー時間(年月日)               | 2000/1/1                                                                                                            |                              | 
| サーバー時間(時分秒)               | 12:34:56                                                                                                            |                              | 
| サーバー時間(タイムゾーン)         | JST                                                                                                                 |                              | 
| イベント                           |                                                                                                                     | ※後述                       | 
| イベント値                         |                                                                                                                     | ※後述                       | 
| ビデオ名                           | tnahJxT-td8 (Youtubeの場合) <br> sample.mp4 (Wowzaの場合)                                                           |                              | 
| URLパラメーター                    | v=tnahJxT-td8 (Youtubeの場合) <br> wowzatokencustomparameter=..(略)..== (Wowzaの場合)                               |                              | 
| ビデオ再生位置                     | 0                                                                                                                   |                              | 
| ユーザーIPアドレス                 | 000.000.000.000                                                                                                     |                              | 
| ユーザーユーザーエージェント       | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36 |                              | 
| LTIに送られたユーザー情報          | lti:1                                                                                                               | getUserKey()で取得する値     | 
| LTIに送られたコース情報            | lti:1                                                                                                               | getCourseKey()で取得する値   | 
| LTIに送られたリソース情報          | lti:1                                                                                                               | getResourceKey()で取得する値 | 
| LTIに送られたnonce                 | d8317e3ec7f0d339209d787f9edd78dc                                                                                    |                              | 
| マイクロコンテンツ用判定キーワード | videoplayerlog                                                                                                      |                              | 


## イベント

| イベント                                                            | イベント値                       | イベント記録タイミング                         | 
| ------------------------------------------------------------------- | -------------------------------- | ---------------------------------------------- | 
| firstplay                                                           | なし                             | ビデオ再生開始時                               | 
| play                                                                | なし                             | ビデオ再生時                                   | 
| pause                                                               | なし                             | ビデオ一時停止時                               | 
| seeked                                                              | シーク操作前のビデオ再生位置     | シークバー操作後                               | 
| ended                                                               | なし                             | ビデオ再生終了時                               | 
| ratechange                                                          | 変更した再生速度倍率             | ビデオ再生速度変更時                           | 
| trackchange                                                         | 字幕切り替え後の言語             | 字幕切り替え時                                 | 
| forward                                                             | なし                             | 早送り実行時                                   | 
| back                                                                | なし                             | 巻き戻し実行時                                 | 
| eforeunload-ended<br>pagehide-ended<br>unload-ended<br>hidden-ended | なし                             | 学習ページから離れた時                         | 
| current-time                                                        | なし                             | 学習ページを開いている間，定期的に取得(10秒毎) | 
| changepage                                                          | 切り替え先のマイクロコンテンツID | マイクロコンテンツ切り替え時                   | 
