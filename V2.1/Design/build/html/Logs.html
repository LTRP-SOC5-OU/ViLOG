

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ja" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ja" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4. ログデータ &mdash; CHiBi-CHiLO V2.1 ドキュメント</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="next" title="5. 用語集" href="Glossary.html" />
    <link rel="prev" title="3. イベント" href="Event.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> CHiBi-CHiLO
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Overview.html">1. CHiBi-CHiLO 設計文書</a></li>
<li class="toctree-l1"><a class="reference internal" href="Database.html">2. DataBase</a></li>
<li class="toctree-l1"><a class="reference internal" href="Event.html">3. イベント</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. ログデータ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">4.1. ログ出力をする対象者</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">4.2. ログの出力先</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">4.3. ログの出力タイミング</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">4.4. ログのフォーマット</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Glossary.html">5. 用語集</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CHiBi-CHiLO</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>4. ログデータ</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Logs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>4. ログデータ<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>本システムのログデータを理解するためには、本システムが扱う「イベント」についても理解しておく必要がある。</p>
<p>イベントについては、 <a class="reference internal" href="Event.html#sect-event"><span class="std std-ref">イベント</span></a> を参照すること。</p>
<div class="section" id="id2">
<h2>4.1. ログ出力をする対象者<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<span id="table-definition-of-logging-user"></span><table border="1" class="colwidths-given docutils" id="id6">
<caption><span class="caption-text">ログ出力するユーザーの定義</span><a class="headerlink" href="#id6" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col width="12%" />
<col width="5%" />
<col width="48%" />
<col width="36%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">対象</th>
<th class="head">ログ取得?</th>
<th class="head">LTIでの対象判定</th>
<th class="head">補足</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>管理者</td>
<td>いいえ</td>
<td><div class="first last line-block">
<div class="line">roles に administrator</div>
<div class="line">が含まれている</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">LMSの管理者からの</div>
<div class="line">アクセスを想定</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>教師</td>
<td>いいえ</td>
<td><div class="first last line-block">
<div class="line">roles に administrator が含まれておらず，</div>
<div class="line">instructor が含まれている</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">LMSの教師やサポーターから</div>
<div class="line">のアクセスを想定</div>
</div>
</td>
</tr>
<tr class="row-even"><td>受講者</td>
<td>はい</td>
<td>上記以外</td>
<td><div class="first last line-block">
<div class="line">LMSの受講者からのアクセス</div>
<div class="line">を想定</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id3">
<h2>4.2. ログの出力先<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>syslogへ出力する。</p>
</div>
<div class="section" id="id4">
<h2>4.3. ログの出力タイミング<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>イベントのタイミングで、出力する。</p>
<p>なので、学生がVideo視聴している間10sec毎を基本として、各種イベントが起きた時には、下記のログフォーマットで書き出す。</p>
</div>
<div class="section" id="id5">
<h2>4.4. ログのフォーマット<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>syslogへ、TSV(タブ区切り)で出力する。</p>
<p>フォーマットについては、 <a class="reference external" href="https://github.com/npocccties/ChibiCHiLO/issues/18">ログ出力の仕様を整理・定義する · Issue #18 · npocccties/ChibiCHiLO</a> でも議論しているので、必要に応じて参照すること。</p>
<span id="table"></span><table border="1" class="colwidths-given docutils" id="id7">
<caption><span class="caption-text">ログフォーマット</span><a class="headerlink" href="#id7" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col width="5%" />
<col width="11%" />
<col width="42%" />
<col width="42%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">No.</th>
<th class="head">項目名</th>
<th class="head">内容例</th>
<th class="head">補足</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td><div class="first last line-block">
<div class="line">サーバー時間</div>
<div class="line">（年月日）</div>
</div>
</td>
<td>2000-01-01</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>2</td>
<td><div class="first last line-block">
<div class="line">サーバー時間</div>
<div class="line">(時分秒)</div>
</div>
</td>
<td>01:01:01</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>3</td>
<td><div class="first last line-block">
<div class="line">サーバー時間</div>
<div class="line">(タイムゾーン)</div>
</div>
</td>
<td>JST</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>Event</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>5</td>
<td>Event Value</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>6</td>
<td>Video名</td>
<td><div class="first last line-block">
<div class="line">tnahJxT-td8 (Youtubeの場合)</div>
<div class="line">sample.mp4 (Wowzaの場合)</div>
<div class="line">1084537  (Vimeo は現在未対応)</div>
</div>
</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>7</td>
<td>URLパラメーター</td>
<td><div class="first last line-block">
<div class="line">v=tnahJxT-td8 (Youtubeの場合)</div>
<div class="line">wowzatokencustomparameter=..(略)..==</div>
<div class="line">(Wowzaの場合)</div>
<div class="line">※未想定 (Vimeo は現在未対応)</div>
</div>
</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>8</td>
<td><div class="first last line-block">
<div class="line">ユーザが視聴している現在の</div>
<div class="line">ビデオ再生位置</div>
</div>
</td>
<td>0 や 16.462621 など</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>9</td>
<td>Client IP Address</td>
<td>xxx.xxx.xxx.xxx</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>10</td>
<td>ブラウザのUA</td>
<td>&#160;</td>
<td>下記参照</td>
</tr>
<tr class="row-even"><td>11</td>
<td>LTIに送られたリソース情報</td>
<td>hoge:1 や huga:1 など</td>
<td>getResourceKey()で取得する値</td>
</tr>
<tr class="row-odd"><td>12</td>
<td>LTIに送られたユーザ情報</td>
<td>hoge:1 や huga:1 など</td>
<td>getUserKey()で取得する値</td>
</tr>
<tr class="row-even"><td>13</td>
<td>LTIに送られたコース情報</td>
<td>hoge:1 や huga:1 など</td>
<td>getCourseKey()で取得する値</td>
</tr>
<tr class="row-odd"><td>14</td>
<td>LTIに送られたnonce</td>
<td>d8317e3ec7f0d339209d787f9edd78dc</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>15</td>
<td><div class="first last line-block">
<div class="line">マイクロコンテンツ</div>
<div class="line">判定キーワード</div>
</div>
</td>
<td>videoplayerlog</td>
<td>固定</td>
</tr>
<tr class="row-odd"><td>16</td>
<td>video種別</td>
<td><div class="first last line-block">
<div class="line">YouTube</div>
<div class="line">Vimeo</div>
<div class="line">Wowza</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">新規追加</div>
<div class="line">20201104</div>
</div>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>サーバ時間(年月日)</dt>
<dd>前システムから踏襲する。YYYY-MM-DD のformatで、0を前置する．</dd>
<dt>サーバ時間（時分秒)</dt>
<dd>前システムから踏襲する。HH:MM:SS のformat で、0を前置する。</dd>
<dt>サーバー時間(タイムゾーン)</dt>
<dd>前システムから踏襲する。2021-01-13の段階では、JST固定です。次期ログ開発で改修予定です。</dd>
<dt>イベント</dt>
<dd>イベントについては、 <a class="reference internal" href="Event.html#sect-event"><span class="std std-ref">イベント</span></a>　を参照せよ。</dd>
<dt>イベント値</dt>
<dd>イベント値について、 <a class="reference internal" href="Event.html#sect-event"><span class="std std-ref">イベント</span></a> に書いていないので、ここか、イベントの方で定義する。これって、「イベントとは別に取得した情報」のことを指していますか?
時間の場合は，ユーザが視聴している現在のビデオ再生位置と同じ値(0 や 16.462621 など)でコンマ秒まで出る．</dd>
<dt>Video名</dt>
<dd>Videoを識別する固有の文字列です。YouTubeはビデオIDになります。
wowzaだと動画のファイル名．
vimeo は未対応だが，対応するならvimeoのビデオIDを想定している。</dd>
<dt>URLパラメータ</dt>
<dd>URLのパラメータを記述する。YouTube, vimeo, wowza で入るものが異なる。 <a href="#id8"><span class="problematic" id="id9">`この辺の議論を参照せよ。&lt;https://github.com/npocccties/ChibiCHiLO/issues/18#issuecomment-758419047&gt;`_</span></a></dd>
<dt>ビデオ再生位置</dt>
<dd>これは、暗黙の了解として「ユーザが視聴している現在のビデオ再生位置」というのが正確な表現になります。
位置の単位はコンマ秒含む秒単位（0 や16.462621 など）最大値はTypeScript,JavaScriptにて表現できる範囲でお願いします。</dd>
<dt>Client IP Address</dt>
<dd>ご指摘がありました。しかし、結論からいうと現在のログはIPv4だけで良いです。次期ログ開発時に、IPv6のアドレスが必要かを議論します。see also <a class="reference external" href="https://github.com/npocccties/ChibiCHiLO-private/issues/16">2021-01-19 ミーティングで確認する内容 · Issue #16 · npocccties/ChibiCHiLO-private</a> を確認する。それまでは、IPv4のみの環境で、フォーマットは既存と同じ、xxx.xxx.xxx.xxx の十進数を.(dot)で区切った数値になります。</dd>
<dt>ブラウザのUA</dt>
<dd>使っているブラウザのユーザエージェントをそのまま記録する。ユーザが設定しているUAをそのまま記録する。</dd>
</dl>
<dl class="docutils">
<dt>LTIに送られたリソース情報</dt>
<dd><span class="xref std std-ref">table利用している連携データ</span> を参照してください。<a class="reference external" href="https://www.imsglobal.org/activity/learning-tools-interoperability">Learning Tools Interoperability | IMS Global Learning Consortium</a> によると、Learning Platform (Moodle/blackboard) から、Learning Tool (Chibi-CHiLO) に、LTIプロトロルを用いてデータを送ってくるので、LTIに送るというのはちょっと違和感があります。あと、lti:1 getUserKey() で取得する値というのは、<span class="xref std std-ref">table利用している連携データ</span> の中身について話だと理解している。しかしどのように利用しているのか。具体的なデータは何かを以下のコース情報、リソース情報に書いてあげる必要がある。
LMSから送られる～に名称を変更したほうがいいか？
lti:1 のコロン(:)より前は，LMSから送られる oauth_consumer_key が入る．LTI_keyがhogeなら，hoge:1 となる
利用している連携データは resource_link_id</dd>
<dt>LTIに送られたユーザ情報</dt>
<dd>同上
利用している連携データは user_id</dd>
<dt>LTIに送られたコース情報</dt>
<dd>同上
利用している連携データは context_id</dd>
</dl>
<dl class="docutils">
<dt>LTIに送られたnonce</dt>
<dd>nonceはLTIサーバにLMSから情報を送るたびに変化する一意の文字列です．
同じユーザが同じコースにあるリソースから来たとしても，変化するので，視聴しなおしたかどうか．判断回数などが分かるようになる
moodleは&quot;6f9beca26ec542e84c71931ad1276137&quot;，backboardは&quot;352126796144595&quot; のように桁数も使用する文字の種類も違うようだが，LTIに情報を送るたびに変化するという仕様は同じ．</dd>
<dt>マイクロコンテンツ判定キーワード</dt>
<dd>本ログの識別子として、videoplayer関係のログであることを示す。固定値</dd>
<dt>video種別</dt>
<dd><span class="strike">YouTube,vimeo,wowza の区別が付くように種別を入れる。2020-11-04追加</span> この部分の追加は、次期log開発時に追加する。</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Glossary.html" class="btn btn-neutral float-right" title="5. 用語集" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Event.html" class="btn btn-neutral float-left" title="3. イベント" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, CCC-TIES

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>